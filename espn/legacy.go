package espn

import (
	"bufio"
	"encoding/json"
	"errors"
	"fmt"
	"io"
	"iter"
	"net/http"
	"os"
	"regexp"
	"strconv"
	"strings"
	"time"
)

func extractGameIds(html string) ([]int, error) {
	gameIds := []int{}
	pattern := regexp.MustCompile(`href="/nba/boxscore/_/gameId/(\d+)"`)
	for _, match := range pattern.FindAllStringSubmatch(html, -1) {
		gameId, err := strconv.Atoi(match[1])
		if err != nil {
			return nil, fmt.Errorf("failed to parse gameId from %s: %w", match[0], err)
		}
		gameIds = append(gameIds, gameId)
	}
	return gameIds, nil
}

func fetchEspnPage(url string) (string, error) {
	// Generated by curl-to-Go: https://mholt.github.io/curl-to-go

	// curl 'https://www.espn.com/nba/scoreboard/_/date/20251103' \
	//   -H 'accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7' \
	//   -H 'accept-language: en-US,en;q=0.9' \
	//   -H 'cache-control: max-age=0' \
	//   -b 'usprivacy=1YYY; s_ecid=MCMID%7C55723336928306564770903480275448033090; device_d30e5cd=de1d960b-6e94-4603-8c1b-43ace948bac1; SWID={6B253B4B-B5BA-4E9C-98AD-377F151E1EBD}; ESPN-ONESITE.WEB-PROD-ac=XUS; AMCVS_EE0201AC512D2BE80A490D4C%40AdobeOrg=1; country=us; s_cc=true; edition=espn-en-us; country=us; edition-view=espn-en-us; region=ccpa; s_ensCDS=0; s_ensNSL=1; s_ensRegion=ccpa; espnAuth={"swid":"{6B253B4B-B5BA-4E9C-98AD-377F151E1EBD}"}; s_ensNR=1760950505215-Repeat; cookieMonster=1; userZip=66968; client_type=html5; client_version=4.7.1; tveProviderName=bvt010; check=true; hashedIp=4c5e6ecb6093056878e49f6e091bc27248119142712aa64ea8a65bd97861d585; _nr=0; _cb=DYvlPmB8U5e0Dvd_80; connectionspeed=full; _chartbeat2=.1725277997405.1761915251574.1101110000101001.CAKsxEBuPy4aDUXGjrD2oqMVCwGrqB.1; dtcAuth=; timeOffset=-6; tveProvider=bvt010; ESPN-ONESITE.WEB-PROD.token=5=eyJhY2Nlc3NfdG9rZW4iOiJleUpyYVdRaU9pSm5kV1Z6ZEdOdmJuUnliMnhzWlhJdExURTJNakF4T1RNMU5EUWlMQ0poYkdjaU9pSkZVekkxTmlKOS5leUpxZEdraU9pSjVUMmxwV0V0U01sRkROSGx4UW5WcFVFeFFlbnAzSWl3aWFYTnpJam9pYUhSMGNITTZMeTloZFhSb0xuSmxaMmx6ZEdWeVpHbHpibVY1TG1kdkxtTnZiU0lzSW1GMVpDSTZJblZ5Ympwa2FYTnVaWGs2YjI1bGFXUTZjSEp2WkNJc0luTjFZaUk2SW5zMlFqSTFNMEkwUWkxQ05VSkJMVFJGT1VNdE9UaEJSQzB6TnpkR01UVXhSVEZGUWtSOUlpd2lhV0YwSWpveE56WXlNVE0xTlRVMExDSnVZbVlpT2pFM05UUXlNalF6TURrc0ltVjRjQ0k2TVRjMk1qSXlNVGsxTkN3aVkyeHBaVzUwWDJsa0lqb2lSVk5RVGkxUFRrVlRTVlJGTGxkRlFpMVFVazlFSWl3aWJHbGtJam9pTURaa1l6STVNMkl0WWpZNVlTMDBZV1ExTFRreE1tWXRNakU0WlRaak5UTmhNamt6SWl3aVkyRjBJam9pWjNWbGMzUWlMQ0pwWkdWdWRHbDBlVjlwWkNJNklqTXlPR1V4Wm1JeUxUWTNaR1V0TkRWa015MWhNRGsyTFRoaFpHUTRaVGRrTXpobE15SjkuNU1peC15b3pLcG4wSkZFOXAtZk1haFpUMUJfV3phYmRKUkg4V2JVcXhoWVVWTW5IUXc2Wkc4Z3pKbGNkOVYxdU9PbjhyZ0pDR1JLZ1RPVHRvSFF2SVEiLCJyZWZyZXNoX3Rva2VuIjoiZXlKcmFXUWlPaUpuZFdWemRHTnZiblJ5YjJ4c1pYSXRMVEUyTWpBeE9UTTFORFFpTENKaGJHY2lPaUpGVXpJMU5pSjkuZXlKcWRHa2lPaUpETTFaNFpXeG1NRFZzVWs5NFpXODJjSGxGZVZSbklpd2ljM1ZpSWpvaWV6WkNNalV6UWpSQ0xVSTFRa0V0TkVVNVF5MDVPRUZFTFRNM04wWXhOVEZGTVVWQ1JIMGlMQ0pwYzNNaU9pSm9kSFJ3Y3pvdkwyRjFkR2d1Y21WbmFYTjBaWEprYVhOdVpYa3VaMjh1WTI5dElpd2lZWFZrSWpvaWRYSnVPbVJwYzI1bGVUcHZibVZwWkRwd2NtOWtJaXdpYVdGMElqb3hOell5TVRNMU5UVTBMQ0p1WW1ZaU9qRTNOVFF5TWpRek1Ea3NJbVY0Y0NJNk1UYzNOelk0TnpVMU5Dd2lZMnhwWlc1MFgybGtJam9pUlZOUVRpMVBUa1ZUU1ZSRkxsZEZRaTFRVWs5RUlpd2lZMkYwSWpvaWNtVm1jbVZ6YUNJc0lteHBaQ0k2SWpBMlpHTXlPVE5pTFdJMk9XRXROR0ZrTlMwNU1USm1MVEl4T0dVMll6VXpZVEk1TXlJc0ltbGtaVzUwYVhSNVgybGtJam9pTXpJNFpURm1Zakl0Tmpka1pTMDBOV1F6TFdFd09UWXRPR0ZrWkRobE4yUXpPR1V6SW4wLjZ4Vk5NTU10QzUxeVJiZmNRLU9TUjBjRm85N1hVOVZXb19iMUhiTWxuUUJtczBsTC1XZ0JqY1o2dzRMaklaSXBZbUNmUVdURktBOEdKcDRSRUpvRVFBIiwic3dpZCI6Ins2QjI1M0I0Qi1CNUJBLTRFOUMtOThBRC0zNzdGMTUxRTFFQkR9IiwidHRsIjo4NjM5OSwicmVmcmVzaF90dGwiOjE1NTUxOTk5LCJoaWdoX3RydXN0X2V4cGlyZXNfaW4iOjAsImluaXRpYWxfZ3JhbnRfaW5fY2hhaW5fdGltZSI6MTc1NDIyNDMwOTAwMCwiaWF0IjoxNzYyMTM1NTU0MDAwLCJleHAiOjE3NjIyMjE5NTQwMDAsInJlZnJlc2hfZXhwIjoxNzc3Njg3NTU0MDAwLCJoaWdoX3RydXN0X2V4cCI6MTc1NDIyNjEwOTAwMCwic3NvIjpudWxsLCJhdXRoZW50aWNhdG9yIjpudWxsLCJsb2dpblZhbHVlIjpudWxsLCJjbGlja2JhY2tUeXBlIjpudWxsLCJzZXNzaW9uVHJhbnNmZXJLZXkiOiJKcWN1M21RR0x1VVRrMkJ2Q1FQaHAzeElwVHdHbGJCMTgyNjRYeDU5Q3QzMWhDOTYxQXcwYWh5UG1xY1lqdllkdzA5R2s4QWZGcnJzZnE1X2V6WnNlZUc0SzBMbFhLTnJ5bnRISU9zWi14R2pvXzYzaEhJIiwiY3JlYXRlZCI6IjIwMjUtMTEtMDNUMDI6MDU6NTMuNzU3WiIsImxhc3RDaGVja2VkIjoiMjAyNS0xMS0wM1QwMjowNTo1My43NTdaIiwiZXhwaXJlcyI6IjIwMjUtMTEtMDRUMDI6MDU6NTQuMDAwWiIsInJlZnJlc2hfZXhwaXJlcyI6IjIwMjYtMDUtMDJUMDI6MDU6NTQuMDAwWiJ9|eyJraWQiOiJndWVzdGNvbnRyb2xsZXItLTE2MjAxOTM1NDQiLCJhbGciOiJFUzI1NiJ9.eyJqdGkiOiI2WEhacE1pM0lsNHhtV2ZhTzFxV1V3IiwiaXNzIjoiaHR0cHM6Ly9hdXRoLnJlZ2lzdGVyZGlzbmV5LmdvLmNvbSIsImF1ZCI6IkVTUE4tT05FU0lURS5XRUItUFJPRCIsInN1YiI6Ins2QjI1M0I0Qi1CNUJBLTRFOUMtOThBRC0zNzdGMTUxRTFFQkR9IiwiaWF0IjoxNzYyMTM1NTU0LCJuYmYiOjE3NTQyMjQzMDksImV4cCI6MTc2MjIyMTk1NCwiY2F0IjoiaWR0b2tlbiIsImVtYWlsIjoiZGF2aWRidXJnZXJAZ21haWwuY29tIiwiaWRlbnRpdHlfaWQiOiIzMjhlMWZiMi02N2RlLTQ1ZDMtYTA5Ni04YWRkOGU3ZDM4ZTMifQ.pIovc8ihfyTTIhq4i0_p19tWsVnAHYTIHhfkabfh8seKGKnkF0ZcaVh3nW4QVnwpeuKh2pz8jDdfg_gCzl0MIw; __fitt-sess-device.prod=5ad31d4a-3c95-45da-baf5-ea94f60f34dd; userab_1=62e5f2d07b3ae6d8bd6be769996f229a~ad_espn-403%2Atest-a-1674%2Ceapp_hfcard-456%2Ac-a-1887%2Ceapp_sc4u-414%2Ap-a-1739%2Ceapp_vertfy-446%2Ap-e-1856%2Cespn_app_homefeed_31_app-455%2Ahfa-a-1876%2Cespn_mweb_pl-454%2Ap-a-1874%2Cespn_watch_for_you-409%2Awatch-fy-a-1711%2Cespn_watch_for_you_web-392%2Awatch-fy-a-1642%2Cespn_watch_rfy_latest-410%2Awatch-fy-a-1716%2Cespn_web_pl-441%2Ap-a-1823%2Cespn_web_standalone_video-113%2Aplethora-a-400%2Ceweb_nav-437%2Anav_a-1815%2Cexm_test-379%2Avariant_a3_new-1572%2Cplayer_next_live-424%2Awatch-fy-a-1772%2Cweb_index1_pres-99%2Aenhanced-346; tveMVPDAuth=espn3; tveAuth=espn1%2Cespn2%2Cespnu%2Cespnews%2Cespndeportes%2Csec%2Clonghorn%2Cbuzzerbeater%2Cgoalline%2Cespn3%2Cespnclassic%2Cacc%2Caccextra%2Cespnvod%2Csecplus; ab.storage.deviceId.96ad02b7-2edc-4238-8442-bc35ba85853c=g%3A085fa996-75d4-3bf1-576f-aa55c2e023c0%7Ce%3Aundefined%7Cc%3A1754874583336%7Cl%3A1762194798773; ab.storage.userId.96ad02b7-2edc-4238-8442-bc35ba85853c=g%3A%257B6B253B4B-B5BA-4E9C-98AD-377F151E1EBD%257D%7Ce%3Aundefined%7Cc%3A1754874583332%7Cl%3A1762194798774; block.check=false%7Cfalse; mbox=session#4eecaf8fe53b48a7a47705092550e41a#1762198550; s_sq=%5B%5BB%5D%5D; s_ensNR=1762197442951-Repeat; _dcf=0; OptanonConsent=isGpcEnabled=1&datestamp=Mon+Nov+03+2025+13%3A17%3A24+GMT-0600+(Central+Standard+Time)&version=202407.2.0&browserGpcFlag=1&isIABGlobal=false&hosts=&consentId=5293683b-7942-4db2-8a28-5afd51eec056&interactionCount=1&isAnonUser=1&landingPath=NotLandingPage&groups=C0001%3A1%2CC0003%3A1%2CBG407%3A0%2CC0002%3A0%2CC0004%3A0%2CC0005%3A0&AwaitingReconsent=false; espn_s2=AEAALGBNaUUorIZ0%2BeMnlVdhPkqTE3SDLLAHljWS8sfoVBidbkGNV3ZpYBD%2BW7INl2HCRYrwzVZxcnaR4DLEXEO5iuvyA3V61I%2Bg9lR5EJBGzg%2FnqL32X7MuQSqZTIbW3itXRnEDhj9DXQe1a5YmRlOtH6DpnXC5CWquPKw0Su7b4eMoTmRAPtAgE8E1PlnJGIZ5mz6P88QJK52C%2BfC2R9T%2FunXDjLBh49GhbIw5ZQVxegZGao9nP84inTWD06IuNTYo6SCpV20G8LN7AZCwvTt9; ESPN-ONESITE.WEB-PROD.idn=001ea97546; espn-prev-page=espn%3Anba%3Ascoreboard; ab.storage.sessionId.96ad02b7-2edc-4238-8442-bc35ba85853c=g%3A695440ce-e1fa-97ca-4c3c-9d89a9cc5608%7Ce%3A1762199245565%7Cc%3A1762194798768%7Cl%3A1762197445565; AMCV_EE0201AC512D2BE80A490D4C%40AdobeOrg=-50417514%7CMCMID%7C55723336928306564770903480275448033090%7CMCAID%7CNONE%7CMCOPTOUT-1762204750s%7CNONE%7CvVersion%7C5.5.0' \
	//   -H 'dnt: 1' \
	//   -H 'if-modified-since: Mon, 03 Nov 2025 19:19:14 GMT' \
	//   -H 'priority: u=0, i' \
	//   -H 'sec-ch-ua: "Google Chrome";v="141", "Not?A_Brand";v="8", "Chromium";v="141"' \
	//   -H 'sec-ch-ua-mobile: ?0' \
	//   -H 'sec-ch-ua-platform: "Linux"' \
	//   -H 'sec-fetch-dest: document' \
	//   -H 'sec-fetch-mode: navigate' \
	//   -H 'sec-fetch-site: same-origin' \
	//   -H 'sec-fetch-user: ?1' \
	//   -H 'sec-gpc: 1' \
	//   -H 'upgrade-insecure-requests: 1' \
	//   -H 'user-agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36'

	req, err := http.NewRequest(http.MethodGet, url, nil)
	if err != nil {
		return "", fmt.Errorf("error creating request: %w", err)
	}
	req.Header.Set("Accept", "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7")
	req.Header.Set("Accept-Language", "en-US,en;q=0.9")
	req.Header.Set("Cache-Control", "max-age=0")
	req.Header.Set("Dnt", "1")
	req.Header.Set("If-Modified-Since", "Mon, 03 Nov 2025 19:19:14 GMT")
	req.Header.Set("Priority", "u=0, i")
	req.Header.Set("Sec-Ch-Ua", "\"Google Chrome\";v=\"141\", \"Not?A_Brand\";v=\"8\", \"Chromium\";v=\"141\"")
	req.Header.Set("Sec-Ch-Ua-Mobile", "?0")
	req.Header.Set("Sec-Ch-Ua-Platform", "\"Linux\"")
	req.Header.Set("Sec-Fetch-Dest", "document")
	req.Header.Set("Sec-Fetch-Mode", "navigate")
	req.Header.Set("Sec-Fetch-Site", "same-origin")
	req.Header.Set("Sec-Fetch-User", "?1")
	req.Header.Set("Sec-Gpc", "1")
	req.Header.Set("Upgrade-Insecure-Requests", "1")
	req.Header.Set("User-Agent", "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36")

	resp, err := http.DefaultClient.Do(req)
	if err != nil {
		return "", fmt.Errorf("error making request: %w", err)
	}
	defer resp.Body.Close()

	body, err := io.ReadAll(resp.Body)
	if err != nil {
		return "", fmt.Errorf("error reading response body: %w", err)
	}

	return string(body), nil
}

func FetchGameIds(date time.Time) ([]int, error) {
	url := fmt.Sprintf("https://www.espn.com/nba/scoreboard/_/date/%s", date.Format("20060102"))
	body, err := fetchEspnPage(url)
	gameIds, err := extractGameIds(body)
	if err != nil {
		return []int{}, fmt.Errorf("error extracting game recap urls: %w", err)
	}

	return gameIds, nil
}

func fetchGame(gameId int) (string, error) {
	// Generated by curl-to-Go: https://mholt.github.io/curl-to-go

	// curl 'https://site.web.api.espn.com/apis/site/v2/sports/basketball/nba/summary?region=us&lang=en&contentorigin=espn&event=401705766' \
	//   -H 'accept: */*' \
	//   -H 'accept-language: en-US,en;q=0.9' \
	//   -H 'dnt: 1' \
	//   -H 'origin: https://www.espn.com' \
	//   -H 'priority: u=1, i' \
	//   -H 'referer: https://www.espn.com/' \
	//   -H 'sec-ch-ua: "Google Chrome";v="141", "Not?A_Brand";v="8", "Chromium";v="141"' \
	//   -H 'sec-ch-ua-mobile: ?0' \
	//   -H 'sec-ch-ua-platform: "Linux"' \
	//   -H 'sec-fetch-dest: empty' \
	//   -H 'sec-fetch-mode: cors' \
	//   -H 'sec-fetch-site: same-site' \
	//   -H 'sec-gpc: 1' \
	//   -H 'user-agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36'

	url := fmt.Sprintf("https://site.web.api.espn.com/apis/site/v2/sports/basketball/nba/summary?region=us&lang=en&contentorigin=espn&event=%d", gameId)

	req, err := http.NewRequest(http.MethodGet, url, nil)
	if err != nil {
		return "", fmt.Errorf("error creating request: %w", err)
	}
	req.Header.Set("Accept", "*/*")
	req.Header.Set("Accept-Language", "en-US,en;q=0.9")
	req.Header.Set("Dnt", "1")
	req.Header.Set("Origin", "https://www.espn.com")
	req.Header.Set("Priority", "u=1, i")
	req.Header.Set("Referer", "https://www.espn.com/")
	req.Header.Set("Sec-Ch-Ua", "\"Google Chrome\";v=\"141\", \"Not?A_Brand\";v=\"8\", \"Chromium\";v=\"141\"")
	req.Header.Set("Sec-Ch-Ua-Mobile", "?0")
	req.Header.Set("Sec-Ch-Ua-Platform", "\"Linux\"")
	req.Header.Set("Sec-Fetch-Dest", "empty")
	req.Header.Set("Sec-Fetch-Mode", "cors")
	req.Header.Set("Sec-Fetch-Site", "same-site")
	req.Header.Set("Sec-Gpc", "1")
	req.Header.Set("User-Agent", "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36")

	resp, err := http.DefaultClient.Do(req)
	if err != nil {
		return "", fmt.Errorf("error making request: %w", err)
	}
	defer resp.Body.Close()

	body, err := io.ReadAll(resp.Body)
	if err != nil {
		return "", fmt.Errorf("error reading response body: %w", err)
	}

	return string(body), nil
}

func extractIntValueFromStatistics(feature string, stats []interface{}) (int, error) {
	str, err := extractDisplayValueFromStatistics(feature, stats)
	if err != nil {
		return 0, err
	}
	return strconv.Atoi(str)
}

func extractIntNumeratorFromStatistics(feature string, stats []interface{}) (int, error) {
	str, err := extractDisplayValueFromStatistics(feature, stats)
	if err != nil {
		return 0, err
	}

	parts := strings.Split(str, "-")
	if len(parts) != 2 {
		return 0, fmt.Errorf("unable to extract numerator from %s for feature %s", str, feature)
	}

	return strconv.Atoi(parts[0])
}

func extractDisplayValueFromStatistics(feature string, stats []interface{}) (string, error) {
	for _, stat := range stats {
		statDetail, ok := stat.(map[string]interface{})
		if !ok {
			return "", errors.New("unable to extract stat detail")
		}

		name, ok := statDetail["name"].(string)
		if !ok {
			return "", errors.New("unable to extract stat name")
		}

		if name == feature {
			str, ok := statDetail["displayValue"].(string)
			if !ok {
				return "", fmt.Errorf("unable to extract stat display value for feature %s", feature)
			}
			return str, nil
		}
	}

	return "", fmt.Errorf("unable to find feature %s", feature)
}

func extractLargestLeadForTeam(team map[string]interface{}) (int, error) {
	stats, ok := team["statistics"].([]interface{})
	if !ok {
		return 0, errors.New("unable to extract statistics")
	}

	ll, err := extractIntValueFromStatistics("largestLead", stats)
	if err == nil {
		return ll, nil
	}

	return ll, nil
}

func extractTeams(body string) ([]interface{}, error) {
	var data map[string]interface{}

	err := json.Unmarshal([]byte(body), &data)
	if err != nil {
		return nil, err
	}

	boxscore, ok := data["boxscore"].(map[string]interface{})
	if !ok {
		return nil, errors.New("unable to extract boxscore")
	}

	teams, ok := boxscore["teams"].([]interface{})
	if !ok {
		return nil, errors.New("unable to extract teams")
	}

	return teams, nil
}

func extractLargestLead(body string) (int, error) {
	var data map[string]interface{}

	err := json.Unmarshal([]byte(body), &data)
	if err != nil {
		return 0, err
	}

	boxscore, ok := data["boxscore"].(map[string]interface{})
	if !ok {
		return 0, errors.New("unable to extract boxscore")
	}

	teams, ok := boxscore["teams"].([]interface{})
	if !ok {
		return 0, errors.New("unable to extract teams")
	}

	team0, ok := teams[0].(map[string]interface{})
	if !ok {
		return 0, errors.New("unable to extract team 0")
	}

	team1, ok := teams[1].(map[string]interface{})
	if !ok {
		return 0, errors.New("unable to extract team 1")
	}

	ll0, err := extractLargestLeadForTeam(team0)
	if err != nil {
		return 0, fmt.Errorf("unable to extract largest lead for team 0: %w", err)
	}

	ll1, err := extractLargestLeadForTeam(team1)
	if err != nil {
		return 0, fmt.Errorf("unable to extract largest lead for team 1: %w", err)
	}

	return max(ll0, ll1), nil
}

func FetchLargestLead(gameId int) (int, error) {
	body, err := fetchGame(gameId)
	if err != nil {
		return 0, fmt.Errorf("unable to fetch game: %w", err)
	}

	ll, err := extractLargestLead(body)
	if err != nil {
		return 0, err
	}

	return ll, nil
}

func FetchComeback(gameId int) (int, error) {
	body, err := fetchGame(gameId)
	if err != nil {
		return 0, fmt.Errorf("unable to fetch game: %w", err)
	}

	teams, err := extractTeams(body)
	if err != nil {
		return 0, err
	}

	team0, ok := teams[0].(map[string]interface{})
	if !ok {
		return 0, errors.New("unable to extract team 0")
	}

	team1, ok := teams[1].(map[string]interface{})
	if !ok {
		return 0, errors.New("unable to extract team 1")
	}

	stats0, ok := team0["statistics"].([]interface{})
	if !ok {
		return 0, errors.New("unable to extract stats0")
	}

	stats1, ok := team1["statistics"].([]interface{})
	if !ok {
		return 0, errors.New("unable to extract stats1")
	}

	fgm0, err := extractIntNumeratorFromStatistics("fieldGoalsMade-fieldGoalsAttempted", stats0)
	if err != nil {
		return 0, err
	}

	fgm1, err := extractIntNumeratorFromStatistics("fieldGoalsMade-fieldGoalsAttempted", stats1)
	if err != nil {
		return 0, err
	}

	tpm0, err := extractIntNumeratorFromStatistics("threePointFieldGoalsMade-threePointFieldGoalsAttempted", stats0)
	if err != nil {
		return 0, err
	}

	tpm1, err := extractIntNumeratorFromStatistics("threePointFieldGoalsMade-threePointFieldGoalsAttempted", stats1)
	if err != nil {
		return 0, err
	}

	ftm0, err := extractIntNumeratorFromStatistics("freeThrowsMade-freeThrowsAttempted", stats0)
	if err != nil {
		return 0, err
	}

	ftm1, err := extractIntNumeratorFromStatistics("freeThrowsMade-freeThrowsAttempted", stats1)
	if err != nil {
		return 0, err
	}

	score0 := 2*(fgm0-tpm0) + 3*(tpm0) + 1*(ftm0)
	score1 := 2*(fgm1-tpm1) + 3*(tpm1) + 1*(ftm1)

	if score0 > score1 {
		return extractIntValueFromStatistics("largestLead", stats1)
	} else {
		return extractIntValueFromStatistics("largestLead", stats0)
	}
}

func Fileids(filename string) iter.Seq[int] {
	// Open the file. Replace "your_file.txt" with the actual file path.
	file, err := os.Open(filename)
	if err != nil {
		fmt.Printf("Error opening file: %v\n", err)
		panic(err)
	}
	defer file.Close() // Ensure the file is closed when the function exits.

	ids := make([]int, 0)

	// Create a new Scanner to read the file line by line.
	scanner := bufio.NewScanner(file)

	// Iterate over each line.
	for scanner.Scan() {
		val, err := strconv.Atoi(scanner.Text())
		if err != nil {
			fmt.Printf("Error parsing line: %v\n", err)
			panic(err)
		}
		// line := scanner.Text() // Get the current line as a string.
		ids = append(ids, val)
		// fmt.Println(line)      // Process or print the line.
	}

	// Check for any errors during scanning.
	if err := scanner.Err(); err != nil {
		fmt.Printf("Error reading file: %v\n", err)
	}

	return func(yield func(int) bool) {
		for _, id := range ids {
			if !yield(id) {
				return
			}
		}
	}
}

func nba2024() iter.Seq[int] {
	return func(yield func(int) bool) {
		startGameId := 401704627
		endGameId := 401705766
		for i := startGameId; i <= endGameId; i++ {
			if !yield(i) {
				return
			}
		}

		// nba cup group play
		// startGameId = 401809243
		startGameId = 401703370
		endGameId = 401703429
		for i := startGameId; i <= endGameId; i++ {
			if !yield(i) {
				return
			}
		}

		// nba cup tourney
		startGameId = 401734902
		endGameId = 401734908
		for i := startGameId; i <= endGameId; i++ {
			if !yield(i) {
				return
			}
		}
	}
}

func nba2025() iter.Seq[int] {
	return func(yield func(int) bool) {
		startGameId := 401809243
		endGameId := 401809246
		for i := startGameId; i <= endGameId; i++ {
			if !yield(i) {
				return
			}
		}

		startGameId = 401809234
		endGameId = 401809237
		for i := startGameId; i <= endGameId; i++ {
			if !yield(i) {
				return
			}
		}

		startGameId = 401809502
		endGameId = 401809509

		startGameId = 401809933
		endGameId = 401810010
		for i := startGameId; i <= endGameId; i++ {
			if !yield(i) {
				return
			}
		}
		// checked up to and including November 2, 2025.
	}
}
